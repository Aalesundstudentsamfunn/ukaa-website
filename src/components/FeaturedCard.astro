---
import { CldImage } from "astro-cloudinary";

export interface Props {
  id: string;
  title: string;
  tag?: string;
  meta?: string;
  people?: string;
  img: string;
  accent: string;
  tint?: string;
}

const { id, title, tag, meta, people, img, accent } = Astro.props as Props;
---

<article
  id={`card-${id}`}
  class="featured-card group relative isolate overflow-hidden rounded-2xl shadow-lg cursor-pointer transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl"
  style={`--accent: ${accent}`}
>
  <button
    type="button"
    class="absolute inset-0 z-50 cursor-pointer"
    aria-label={`Åpne ${title}${meta ? ` – ${meta}` : ""}`}
    aria-haspopup="dialog"
    aria-controls={id}
    data-open
    data-target={id}
  ></button>

  <div class="relative overflow-hidden" data-img-wrapper>
    <div class="absolute inset-0 skeleton"></div>

    <CldImage
      draggable="false"
      src={img}
      alt={title}
      class="h-72 w-full opacity-0 object-cover transition-transform duration-500 group-hover:scale-[1.07] sm:h-80"
      sizes="(min-width: 1024px) 33vw, 100vw"
      loading="lazy"
      fetchpriority="low"
      onload="this.style.opacity='1'; this.closest('[data-img-wrapper]')?.setAttribute('data-loaded','true');"
    />

    <!-- Brand-color tint from top -->
    <div
      class="absolute inset-0 z-[4] pointer-events-none"
      style={`background: linear-gradient(to bottom, ${accent}44, transparent 55%)`}
    ></div>

    <!-- Dark gradient for text readability -->
    <div class="absolute inset-0 z-[5] pointer-events-none bg-gradient-to-t from-black/70 via-black/15 to-transparent"></div>

    <!-- Content -->
    <div class="absolute inset-0 z-[11] flex flex-col justify-between p-5 pointer-events-none">
      <div class="flex items-start justify-between">
        <div>
          {tag && (
            <span
              class="inline-flex items-center rounded-full px-3.5 py-1.5 text-xs font-bold text-neutral-900 shadow-md"
              style={`background-color: ${accent}`}
            >
              {tag}
            </span>
          )}
        </div>

        <!-- Hover expand indicator -->
        <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300">
          <div
            class="flex h-8 w-8 items-center justify-center rounded-full border border-white/30"
            style="background: rgba(255,255,255,0.15); backdrop-filter: blur(6px);"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-3.5 w-3.5 text-white">
              <path fill-rule="evenodd" d="M5.22 14.78a.75.75 0 0 0 1.06 0l7.22-7.22v5.69a.75.75 0 0 0 1.5 0v-7.5a.75.75 0 0 0-.75-.75h-7.5a.75.75 0 0 0 0 1.5h5.69l-7.22 7.22a.75.75 0 0 0 0 1.06Z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
      </div>

      <div>
        <h3 class="text-[1.7rem] font-extrabold leading-tight text-white sm:text-[2rem] drop-shadow-md">
          {title}
        </h3>
        {(meta || people) && (
          <div class="mt-2.5 flex flex-wrap items-center gap-2 text-xs font-semibold sm:text-sm">
            {meta && (
              <span
                class="inline-flex rounded-full px-3 py-1 text-neutral-900 shadow-sm"
                style={`background-color: ${accent}`}
              >
                {meta}
              </span>
            )}
            {people && (
              <span class="inline-flex rounded-full bg-white/90 px-3 py-1 text-neutral-800 shadow-sm">
                {people}
              </span>
            )}
          </div>
        )}
      </div>
    </div>

    <!-- Accent bottom strip -->
    <div
      class="absolute bottom-0 left-0 right-0 z-[12] h-1.5 pointer-events-none"
      style={`background-color: ${accent}`}
    ></div>
  </div>
</article>
