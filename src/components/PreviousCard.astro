---
import { CldImage } from "astro-cloudinary";
import Card from "./ui/Card.astro";

export interface Props {
  id: string;
  title: string;
  tag?: string;
  meta?: string;
  year?: string;
  people?: string;
  img: string; // Cloudinary public ID
  tint: string;
}

const { id, title, tag, meta, year, people, img, tint } = Astro.props as Props;
const metaLabel = meta ?? year;
---

<Card as="article" id={`card-${id}`} class="memory-card isolate contain-[paint] bg-[#fff4de] ring-1 ring-[#d5b36c]/45 cursor-pointer transform transition-transform hover:scale-[1.01]">
  <button type="button" class="absolute inset-0 z-50 cursor-pointer" aria-label={`Ã…pne ${title}${metaLabel ? ` ${metaLabel}` : ""}`} aria-haspopup="dialog" aria-controls={id} data-open data-target={id}></button>

  <div class="relative overflow-hidden clip rounded-inherit isolate">
    <div class="group relative will-change-transform transition-[transform,filter] hover:brightness-[1.03]" data-img-wrapper>
      <div class="absolute inset-0 skeleton"></div>

      <CldImage draggable="false" src={img} alt={title} class="h-60 w-full opacity-0 object-cover brightness-[0.96] contrast-[1.07] saturate-[1.08] transition-transform duration-300 group-hover:scale-[1.08] sm:h-[17.5rem]" sizes="(min-width: 1024px) 33vw, 100vw" loading="lazy" fetchpriority="low" onload="this.style.opacity='1'; this.closest('[data-img-wrapper]')?.setAttribute('data-loaded','true');" />

      <div class={`absolute inset-0 z-5 pointer-events-none bg-linear-to-tr ${tint}`} style="border-radius: inherit; opacity: .74"></div>
      <div class="absolute inset-0 z-6 pointer-events-none bg-linear-to-t from-black/28 via-black/8 to-transparent"></div>
      <div class="absolute inset-0 z-7 pointer-events-none bg-[radial-gradient(circle_at_78%_10%,rgba(255,255,255,0.26),transparent_40%)]"></div>

      <div class="absolute inset-0 z-11 flex flex-col justify-between p-4 pointer-events-none sm:p-5" style="border-radius: inherit">
        <div class="pt-0.5">
          {tag && <span class={`relative inline-flex items-center rounded-full border border-white/80 bg-linear-to-r ${tint} px-3.5 py-1 text-xs font-bold text-neutral-900 backdrop-blur-sm`}>{tag}</span>}
        </div>

        <div class="rounded-2xl border border-white/55 bg-white/22 p-4 text-white backdrop-blur-sm">
          <h3 class="text-2xl font-extrabold leading-[1.05] sm:text-[2.05rem] [text-shadow:0_1px_8px_rgba(0,0,0,0.32)]">
            {title}
          </h3>
          {(metaLabel || people) && (
            <div class="mt-3 flex flex-wrap items-center gap-2 text-xs font-semibold sm:text-sm">
              {metaLabel && <span class="inline-flex rounded-full border border-white/65 bg-white/85 px-2.5 py-1 text-neutral-900">{metaLabel}</span>}
              {people && <span class="inline-flex rounded-full border border-white/65 bg-white/85 px-2.5 py-1 text-neutral-900">{people}</span>}
            </div>
          )}
        </div>
      </div>
    </div>
  </div>
</Card>
